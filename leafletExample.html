<html>
<head>
  <!-- the following links add the CSS and Javascript required for the Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js" integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA==" crossorigin="">
  </script>
  <!--add a jquery request in order to access the library-->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <!-- the following CSS is used to set the size of the Map -->
  <style type="text/css"> #mapid { height: 180px; } </style>
  <!-- the following links incorporate the CSS required for custom icon creation -->
  <link rel="stylesheet" href="ionicons.min.css">
  <link rel="stylesheet" href="leaflet.awesome-markers.css">
  <script src="leaflet.awesome-markers.js"></script>
</head>
<body> <!-- the mapid div will hold the map -->
    <!-- div will create a section that holds the item -->
    <div id="mapid" style="width: 600px; height: 400px;"></div>
    <!-- the following script will load the map and set the default view and zoom, as well as loading the basemap tiles -->
    <!--<script>
      // load the map
      var mymap = L.map('mapid').setView([51.505, -0.09], 13);
      // load the tiles
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', { maxZoom: 18, attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' + '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery © <a href="http://mapbox.com">Mapbox</a>', id: 'mapbox.streets' }).addTo(mymap);
      // add a point
      L.marker([51.5, -0.09]).addTo(mymap) .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();
      // add a circle
      L.circle([51.508, -0.11], 500, { color: 'red', fillColor: '#f03', fillOpacity: 0.5 }).addTo(mymap).bindPopup("I am a circle.");
      // add a polygon with 3 end points (i.e. a triangle)
      var myPolygon = L.polygon([ [51.509, -0.08], [51.503, -0.06], [51.51, -0.047] ],{ color: 'red', fillColor: '#f03', fillOpacity: 0.5 }).addTo(mymap).bindPopup("I am a polygon.");
    </script>-->
    <script>
      // global variable to store the map
      var mymap;
      var popup = L.popup();
      var earthquakeLayer;

      // All function below
      // a function to request earthquake data
      function getEarthquakeData() {
        var layerURL = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";
        // create custom icon
        var testMarkerRed = L.AwesomeMarkers.icon({ icon: 'play', markerColor: 'red' });
        var testMarkerPink = L.AwesomeMarkers.icon({ icon: 'play', markerColor: 'pink' });
        $.ajax({url: layerURL, crossDomain: true,success: function(result){ console.log(result);
          // check that the data is correct , a console log
          // add the JSON layer onto the map - it will appear using the default icons
          // magnitude is 1.75 or less = pink; larger than is red
          earthquakelayer = L.geoJson(result, { pointToLayer: function (feature, latlng) {
            if (feature.properties.mag > 1.75) { return L.marker(latlng, {icon:testMarkerRed}).bindPopup("<b>"+feature.properties.place +"</b>"); }
            else { return L.marker(latlng, {icon:testMarkerPink}).bindPopup("<b>"+feature.properties.place +"</b>");; } }, }).addTo(mymap);
          // change the map zoom so that all the data is shown
          mymap.fitBounds(earthquakelayer.getBounds()); }
          }); // end of the inner function
          } // end of the ajax request
          // end of the getEarthquakeData function

      // create an event detector to wait for the user's click event and then use the popup to show them where they clicked
      // note that you don't need to do any complicated maths to convert screen coordinates to real world coordiantes - the Leaflet API does this for you
      function onMapClick(e) { popup .setLatLng(e.latlng) .setContent("You clicked the map at " + e.latlng.toString()) .openOn(mymap); }
      console.log(loadLeafletMap);
      function loadLeafletMap() { mymap = L.map('mapid').setView([51.505, -0.09], 13);
      // load the tiles
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', { maxZoom: 18, attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' + '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery © <a href="http://mapbox.com">Mapbox</a>', id: 'mapbox.streets' }).addTo(mymap);
      // now add the click event detector to the map
      mymap.on('click', onMapClick);
      // now call the code to add the markers
      addBasicMarkers(); }
      console.log(loadLeafletMap);
      //end code to add the leaflet map
      console.log(addBasicMarkers);
      function addBasicMarkers() {
        // create custom icon
        var testMarkerPink = L.AwesomeMarkers.icon({ icon: 'play', markerColor: 'pink' });
        // add a point
        L.marker([51.5, -0.09]).addTo(mymap) .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();
        // create a geoJSON feature -
        var geojsonFeature = {
          "type": "Feature",
          "properties": {
            "name": "London",
            "popupContent": "This is where UCL is based"
          },
          "geometry": {
            "type": "Point",
            "coordinates": [-0.133481, 51.524611] } };
            // and add it to the map with icon
            L.geoJSON(geojsonFeature, { pointToLayer: function (feature, latlng) { return L.marker(latlng, {icon:testMarkerPink}); } }).addTo(mymap).bindPopup("<b>"+geojsonFeature.properties.name+" "+geojsonFeature.properties.popupContent+"<b>");
            // L.geoJSON(geojsonFeature).addTo(mymap).bindPopup("<b>"+geojsonFeature.properties.name+" "+geojsonFeature.properties.popupContent+"<b>");
        } // end code to add the basic markers
      console.log(addBasicMarkers);
      // here define the order of loading map
      // window.onload = loadLeafletMap;
      document.addEventListener('DOMContentLoaded', function() { loadMap(); }, false);
      function loadMap() { loadLeafletMap(); getEarthquakeData(); } // basemap first than the earthquake data

    </script>>
</body>
</html>
